(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fetchNews_1 = require("./fetchNews");
const newsRepo_1 = __importDefault(require("./newsRepo"));
let globalNewsRepo = new newsRepo_1.default();
function emptyElement(elm) {
    if (elm)
        while (elm.firstChild) {
            elm.removeChild(elm.firstChild);
        }
    return elm;
}
//@ts-ignore The event is tiyen specific
function keyEventHandler(event) {
    if (event.keyName === "back") {
        try {
            //@ts-ignore Tizen declaration should be added
            if (tizen)
                tizen.application.getCurrentApplication().exit();
        }
        catch (ignore) { }
    }
}
function addTextElement(objElm, textClass, textContent) {
    var newElm = document.createElement("p");
    newElm.className = textClass;
    if (textContent)
        newElm.appendChild(document.createTextNode(textContent));
    if (objElm)
        objElm.appendChild(newElm);
}
const areaNews = () => document.querySelector("#area-news");
const areaPageNum = () => document.querySelector("#area-pagenum");
function addSubject(text) { addTextElement(areaNews(), "subject", text); }
function showNews(newsRepo) {
    const objNews = areaNews(), objPagenum = areaPageNum();
    emptyElement(objNews);
    addSubject(newsRepo.arrayNews[newsRepo.indexDisplay].title);
    emptyElement(objPagenum);
    addTextElement(objPagenum, "pagenum", "Page " + (newsRepo.indexDisplay + 1) + "/" + newsRepo.arrayNews.length);
}
function showNextNews() {
    const lengthNews = globalNewsRepo.arrayNews.length;
    if (lengthNews > 0) {
        globalNewsRepo.indexDisplay = (globalNewsRepo.indexDisplay + 1) % lengthNews;
        showNews(globalNewsRepo);
    }
}
function getDataFromXML() {
    const XML_ADDRESS = "https://www.tizen.org/blogs/feed";
    globalNewsRepo.indexDisplay = 0;
    try {
        fetchNews_1.fetchNews(XML_ADDRESS, (localArrayNews) => {
            globalNewsRepo.arrayNews = localArrayNews; //Store news data in global repository
            emptyElement(areaNews());
            showNews(globalNewsRepo);
        });
    }
    catch (e) {
        if (e instanceof Error)
            addSubject(e.message);
        else
            addSubject(e);
    }
}
function setDefaultEvents() {
    //@ts-ignore This is a Tizen device specific event and should be defined
    document.addEventListener("tizenhwkey", keyEventHandler);
    const an = areaNews();
    if (an)
        an.addEventListener("click", showNextNews);
}
function init() {
    setDefaultEvents();
    getDataFromXML();
}
window.onload = init;

},{"./fetchNews":2,"./newsRepo":3}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function _trimText(text, maxLength) {
    let trimmedString;
    if (text && text.length > maxLength) {
        trimmedString = text.substring(0, maxLength - 3) + "...";
    }
    else {
        trimmedString = text;
    }
    return trimmedString;
}
exports.fetchNews = (url, callback) => {
    const XML_METHOD = "GET";
    const MSG_ERR_NODATA = "There is no news from tizen.org";
    const MSG_ERR_NOTCONNECTED = "Connection aborted. Check your internet connection.";
    let xmlhttp = new XMLHttpRequest();
    let xmlDoc;
    let dataItem;
    xmlhttp.open(XML_METHOD, url, false);
    xmlhttp.onreadystatechange = function _requestCompleted() {
        if (xmlhttp && xmlhttp.readyState === 4 && xmlhttp.status === 200) {
            xmlDoc = xmlhttp.responseXML;
            if (xmlDoc)
                dataItem = xmlDoc.getElementsByTagName("item");
            if (dataItem.length > 0) {
                const NUM_MAX_NEWS = 5, NUM_MAX_LENGTH_SUBJECT = 64;
                let lengthNews = 0;
                let arrayNews = [];
                lengthNews = (dataItem.length > NUM_MAX_NEWS) ? NUM_MAX_NEWS : dataItem.length;
                for (let i = 0; i < lengthNews; i++) {
                    arrayNews.push({
                        title: dataItem[i].getElementsByTagName("title")[0].childNodes[0].nodeValue,
                        link: dataItem[i].getElementsByTagName("link")[0].childNodes[0].nodeValue,
                    });
                    arrayNews[i].title = _trimText(arrayNews[i].title, NUM_MAX_LENGTH_SUBJECT);
                }
                callback(arrayNews);
            }
            else {
                throw new Error(MSG_ERR_NODATA);
            }
            xmlhttp = null;
        }
        else {
            throw new Error(MSG_ERR_NOTCONNECTED);
        }
    };
    xmlhttp.send();
};

},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class NewsRepo {
    constructor() {
        this.indexDisplay = 0;
        this.arrayNews = [];
    }
}
exports.default = NewsRepo;

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvYXBwLnRzIiwic3JjL2pzL2ZldGNoTmV3cy50cyIsInNyYy9qcy9uZXdzUmVwby50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FDQUEsMkNBQStDO0FBQy9DLDBEQUFpQztBQUVqQyxJQUFJLGNBQWMsR0FBRyxJQUFJLGtCQUFRLEVBQUUsQ0FBQTtBQUVuQyxTQUFTLFlBQVksQ0FBQyxHQUFrQjtJQUNwQyxJQUFHLEdBQUc7UUFBRSxPQUFPLEdBQUcsQ0FBQyxVQUFVLEVBQUU7WUFDM0IsR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDbkM7SUFDRCxPQUFPLEdBQUcsQ0FBQTtBQUNkLENBQUM7QUFFRCx3Q0FBd0M7QUFDeEMsU0FBUyxlQUFlLENBQUMsS0FBUztJQUM5QixJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssTUFBTSxFQUFFO1FBQzFCLElBQUk7WUFDQSw4Q0FBOEM7WUFDOUMsSUFBRyxLQUFLO2dCQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUM5RDtRQUFDLE9BQU8sTUFBTSxFQUFFLEdBQUU7S0FDdEI7QUFDTCxDQUFDO0FBRUQsU0FBUyxjQUFjLENBQUMsTUFBcUIsRUFBRSxTQUFnQixFQUFFLFdBQXlCO0lBQ3RGLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekMsTUFBTSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDN0IsSUFBRyxXQUFXO1FBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDekUsSUFBRyxNQUFNO1FBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMxQyxDQUFDO0FBRUQs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QUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUzt3QkFDM0UsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUztxQkFDNUUsQ0FBQyxDQUFDO29CQUNILFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsc0JBQXNCLENBQUMsQ0FBQTtpQkFDN0U7Z0JBQ0QsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFBO2FBQ3RCO2lCQUFNO2dCQUNILE1BQU0sSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUE7YUFDbEM7WUFDRCxPQUFPLEdBQUcsSUFBSSxDQUFBO1NBQ2pCO2FBQU07WUFDSCxNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUE7U0FDeEM7SUFDTCxDQUFDLENBQUM7SUFDRixPQUFPLENBQUMsSUFBSSxFQUFFLENBQUE7QUFDbEIsQ0FBQyxDQUFBOzs7OztBQ2hERCxNQUFxQixRQUFRO0lBQTdCO1FBQ0ksaUJBQVksR0FBRyxDQUFDLENBQUE7UUFDaEIsY0FBUyxHQUFlLEVBQUUsQ0FBQTtJQUM5QixDQUFDO0NBQUE7QUFIRCwyQkFHQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImltcG9ydCB7ZmV0Y2hOZXdzLElOZXdzSXRlbX0gZnJvbSBcIi4vZmV0Y2hOZXdzXCJcbmltcG9ydCBOZXdzUmVwbyBmcm9tIFwiLi9uZXdzUmVwb1wiXG5cbmxldCBnbG9iYWxOZXdzUmVwbyA9IG5ldyBOZXdzUmVwbygpXG5cbmZ1bmN0aW9uIGVtcHR5RWxlbWVudChlbG06RWxlbWVudCB8IG51bGwpIHtcbiAgICBpZihlbG0pIHdoaWxlIChlbG0uZmlyc3RDaGlsZCkge1xuICAgICAgICBlbG0ucmVtb3ZlQ2hpbGQoZWxtLmZpcnN0Q2hpbGQpO1xuICAgIH1cbiAgICByZXR1cm4gZWxtXG59XG5cbi8vQHRzLWlnbm9yZSBUaGUgZXZlbnQgaXMgdGl5ZW4gc3BlY2lmaWNcbmZ1bmN0aW9uIGtleUV2ZW50SGFuZGxlcihldmVudDphbnkpIHtcbiAgICBpZiAoZXZlbnQua2V5TmFtZSA9PT0gXCJiYWNrXCIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vQHRzLWlnbm9yZSBUaXplbiBkZWNsYXJhdGlvbiBzaG91bGQgYmUgYWRkZWRcbiAgICAgICAgICAgIGlmKHRpemVuKSB0aXplbi5hcHBsaWNhdGlvbi5nZXRDdXJyZW50QXBwbGljYXRpb24oKS5leGl0KCk7XG4gICAgICAgIH0gY2F0Y2ggKGlnbm9yZSkge31cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFkZFRleHRFbGVtZW50KG9iakVsbTpFbGVtZW50IHwgbnVsbCwgdGV4dENsYXNzOnN0cmluZywgdGV4dENvbnRlbnQ6c3RyaW5nIHwgbnVsbCkge1xuICAgIHZhciBuZXdFbG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICBuZXdFbG0uY2xhc3NOYW1lID0gdGV4dENsYXNzO1xuICAgIGlmKHRleHRDb250ZW50KSBuZXdFbG0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dENvbnRlbnQpKTtcbiAgICBpZihvYmpFbG0pIG9iakVsbS5hcHBlbmRDaGlsZChuZXdFbG0pO1xufVxuXG5jb25zdCBhcmVhTmV3cyA9ICgpID0+ICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FyZWEtbmV3c1wiKVxuY29uc3QgYXJlYVBhZ2VOdW0gPSAoKSA9PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FyZWEtcGFnZW51bVwiKVxuZnVuY3Rpb24gYWRkU3ViamVjdCh0ZXh0OnN0cmluZyB8IG51bGwpIHthZGRUZXh0RWxlbWVudChhcmVhTmV3cygpLFwic3ViamVjdFwiLHRleHQpfVxuZnVuY3Rpb24gc2hvd05ld3MobmV3c1JlcG86TmV3c1JlcG8pOnZvaWQge1xuICAgIGNvbnN0IG9iak5ld3MgPSBhcmVhTmV3cygpLCBvYmpQYWdlbnVtID0gYXJlYVBhZ2VOdW0oKVxuICAgIGVtcHR5RWxlbWVudChvYmpOZXdzKTtcbiAgICBhZGRTdWJqZWN0KG5ld3NSZXBvLmFycmF5TmV3c1tuZXdzUmVwby5pbmRleERpc3BsYXldLnRpdGxlKTtcbiAgICBlbXB0eUVsZW1lbnQob2JqUGFnZW51bSk7XG4gICAgYWRkVGV4dEVsZW1lbnQob2JqUGFnZW51bSwgXCJwYWdlbnVtXCIsIFwiUGFnZSBcIiArIChuZXdzUmVwby5pbmRleERpc3BsYXkgKyAxKSArIFwiL1wiICsgbmV3c1JlcG8uYXJyYXlOZXdzLmxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIHNob3dOZXh0TmV3cygpIHtcbiAgICBjb25zdCBsZW5ndGhOZXdzID0gZ2xvYmFsTmV3c1JlcG8uYXJyYXlOZXdzLmxlbmd0aDtcbiAgICBpZiAobGVuZ3RoTmV3cyA+IDApIHtcbiAgICAgICAgZ2xvYmFsTmV3c1JlcG8uaW5kZXhEaXNwbGF5ID0gKGdsb2JhbE5ld3NSZXBvLmluZGV4RGlzcGxheSArIDEpICUgbGVuZ3RoTmV3cztcbiAgICAgICAgc2hvd05ld3MoZ2xvYmFsTmV3c1JlcG8pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0RGF0YUZyb21YTUwoKSB7XG4gICAgY29uc3QgWE1MX0FERFJFU1MgPSBcImh0dHBzOi8vd3d3LnRpemVuLm9yZy9ibG9ncy9mZWVkXCJcbiAgICBnbG9iYWxOZXdzUmVwby5pbmRleERpc3BsYXkgPSAwO1xuICAgIHRyeSB7XG4gICAgICAgIGZldGNoTmV3cyhYTUxfQUREUkVTUywobG9jYWxBcnJheU5ld3MpID0+IHtcbiAgICAgICAgICAgIGdsb2JhbE5ld3NSZXBvLmFycmF5TmV3cyA9IGxvY2FsQXJyYXlOZXdzOyAvL1N0b3JlIG5ld3MgZGF0YSBpbiBnbG9iYWwgcmVwb3NpdG9yeVxuICAgICAgICAgICAgZW1wdHlFbGVtZW50KGFyZWFOZXdzKCkpO1xuICAgICAgICAgICAgc2hvd05ld3MoZ2xvYmFsTmV3c1JlcG8pO1xuICAgICAgICB9KVxuICAgIH0gY2F0Y2goZSkge1xuICAgICAgICBpZihlIGluc3RhbmNlb2YgRXJyb3IpIGFkZFN1YmplY3QoZS5tZXNzYWdlKVxuICAgICAgICBlbHNlIGFkZFN1YmplY3QoZSlcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNldERlZmF1bHRFdmVudHMoKTp2b2lkIHtcbiAgICAvL0B0cy1pZ25vcmUgVGhpcyBpcyBhIFRpemVuIGRldmljZSBzcGVjaWZpYyBldmVudCBhbmQgc2hvdWxkIGJlIGRlZmluZWRcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidGl6ZW5od2tleVwiLCBrZXlFdmVudEhhbmRsZXIpXG4gICAgY29uc3QgYW4gPSBhcmVhTmV3cygpXG4gICAgaWYoYW4pIGFuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzaG93TmV4dE5ld3MpXG59XG5cbmZ1bmN0aW9uIGluaXQoKTp2b2lkIHtcbiAgICBzZXREZWZhdWx0RXZlbnRzKClcbiAgICBnZXREYXRhRnJvbVhNTCgpXG59XG5cbndpbmRvdy5vbmxvYWQgPSBpbml0XG4iLCJmdW5jdGlvbiBfdHJpbVRleHQodGV4dDpzdHJpbmcgfCBudWxsLCBtYXhMZW5ndGg6bnVtYmVyKSB7XG4gICAgbGV0IHRyaW1tZWRTdHJpbmc7XG4gICAgaWYgKHRleHQgJiYgdGV4dC5sZW5ndGggPiBtYXhMZW5ndGgpIHtcbiAgICAgICAgdHJpbW1lZFN0cmluZyA9IHRleHQuc3Vic3RyaW5nKDAsIG1heExlbmd0aCAtIDMpICsgXCIuLi5cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0cmltbWVkU3RyaW5nID0gdGV4dDtcbiAgICB9XG4gICAgcmV0dXJuIHRyaW1tZWRTdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU5ld3NJdGVtIHtcbiAgICB0aXRsZTogc3RyaW5nIHwgbnVsbCxcbiAgICBsaW5rOiBzdHJpbmcgfCBudWxsLFxufVxudHlwZSBUTmV3c0l0ZW1DYWxsYmFja0Z1bmN0aW9uID0gKG5ld3NBcnJheTpJTmV3c0l0ZW1bXSkgPT4gdm9pZFxuZXhwb3J0IGNvbnN0IGZldGNoTmV3cyA9ICh1cmw6c3RyaW5nLCBjYWxsYmFjazpUTmV3c0l0ZW1DYWxsYmFja0Z1bmN0aW9uKTp2b2lkID0+IHtcbiAgICBjb25zdCBYTUxfTUVUSE9EID0gXCJHRVRcIlxuICAgIGNvbnN0IE1TR19FUlJfTk9EQVRBID0gXCJUaGVyZSBpcyBubyBuZXdzIGZyb20gdGl6ZW4ub3JnXCJcbiAgICBjb25zdCBNU0dfRVJSX05PVENPTk5FQ1RFRCA9IFwiQ29ubmVjdGlvbiBhYm9ydGVkLiBDaGVjayB5b3VyIGludGVybmV0IGNvbm5lY3Rpb24uXCJcbiAgICBsZXQgeG1saHR0cDpYTUxIdHRwUmVxdWVzdCB8IG51bGwgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICBsZXQgeG1sRG9jO1xuICAgIGxldCBkYXRhSXRlbTpIVE1MQ29sbGVjdGlvbk9mPEVsZW1lbnQ+O1xuXG4gICAgeG1saHR0cC5vcGVuKFhNTF9NRVRIT0QsIHVybCwgZmFsc2UpO1xuICAgIHhtbGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gX3JlcXVlc3RDb21wbGV0ZWQoKTp2b2lkIHtcbiAgICAgICAgaWYgKHhtbGh0dHAgJiYgeG1saHR0cC5yZWFkeVN0YXRlID09PSA0ICYmIHhtbGh0dHAuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHhtbERvYyA9IHhtbGh0dHAucmVzcG9uc2VYTUw7XG4gICAgICAgICAgICBpZih4bWxEb2MpIGRhdGFJdGVtID0geG1sRG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaXRlbVwiKTtcbiAgICAgICAgICAgIGlmIChkYXRhSXRlbS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgTlVNX01BWF9ORVdTID0gNSwgTlVNX01BWF9MRU5HVEhfU1VCSkVDVCA9IDY0XG4gICAgICAgICAgICAgICAgbGV0IGxlbmd0aE5ld3MgPSAwO1xuICAgICAgICAgICAgICAgIGxldCBhcnJheU5ld3M6SU5ld3NJdGVtW10gPSBbXTtcbiAgICAgICAgICAgICAgICBsZW5ndGhOZXdzID0gKGRhdGFJdGVtLmxlbmd0aCA+IE5VTV9NQVhfTkVXUykgPyBOVU1fTUFYX05FV1MgOiBkYXRhSXRlbS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGhOZXdzOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlOZXdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGRhdGFJdGVtW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGl0bGVcIilbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rOiBkYXRhSXRlbVtpXS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImxpbmtcIilbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBhcnJheU5ld3NbaV0udGl0bGUgPSBfdHJpbVRleHQoYXJyYXlOZXdzW2ldLnRpdGxlLCBOVU1fTUFYX0xFTkdUSF9TVUJKRUNUKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhhcnJheU5ld3MpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihNU0dfRVJSX05PREFUQSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHhtbGh0dHAgPSBudWxsXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoTVNHX0VSUl9OT1RDT05ORUNURUQpXG4gICAgICAgIH1cbiAgICB9O1xuICAgIHhtbGh0dHAuc2VuZCgpXG59XG4iLCJpbXBvcnQge0lOZXdzSXRlbX0gZnJvbSBcIi4vZmV0Y2hOZXdzXCJcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTmV3c1JlcG8ge1xuICAgIGluZGV4RGlzcGxheSA9IDBcbiAgICBhcnJheU5ld3M6SU5ld3NJdGVtW10gPSBbXVxufVxuIl19
